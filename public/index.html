<!doctype html>
<html lang="de">
  <head>
    <title>Blubbsonntag</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml" sizes="any">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="output.css" rel="stylesheet">
  </head>

  <body class="flex flex-col mx-auto px-3">

    <!-- Header -->
    <section class="section mt-5">
      <!-- border -->
      <div style="border: 1px solid rgba(255, 255, 255, .3)!important; border-radius: 20px;">
        <div class="header card flex flex-col justify-end h-64 text-white">
          <div class="gradient-overlay"></div>

          <h1 class="heading text-xl z-10">Blubbsonntag</h1>
          <div class="flex z-10">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>  
            <h5 class="ms-1">jeden Sonntag, 20 Uhr</h5>
          </div>
        </div>
    </div>

    </section>

    <section id="countdown-section" class="section mt-5">
      <div id="countdown" class="flex flex-row justify-between text-center">
        <div class="frosted countdown-item">
          <h1 id="days" class="heading">0</h1>
          <h5 class="text-xs">Tage</h5>
        </div>
        <img src="colon.svg" alt="Doppelpunkt" class="colon" />
        <div class="frosted countdown-item">
          <h1 id="hours" class="heading">0</h1>
          <h5 class="text-xs">Stunden</h5>
        </div>
        <img src="colon.svg" alt="Doppelpunkt" class="colon" />
        <div class="frosted countdown-item">
          <h1 id="minutes" class="heading">0</h1>
          <h5 class="text-xs">Minuten</h5>
        </div>
        <img src="colon.svg" alt="Doppelpunkt" class="colon" />
        <div class="frosted countdown-item">
          <h1 id="seconds" class="heading">0</h1>
          <h5 class="text-xs">Sekunden</h5>
        </div>
      </div>
    </section>

    <!-- Calendar -->
    <section class="section mt-5">
      <div class="card frosted">
        <h1 class="heading text-lg">Abonniere jetzt den Blubbsonntag-Kalender!</h1>
        <h5 class="text-md mt-1">Nie wieder Blubbsonntag vergessen...</h5>
        <a href="webcal://cloud.eosander12.de/remote.php/dav/public-calendars/gqzNCj6irtR3dr83?export" class="cta-button mt-4">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
            <path d="M10 9.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V10a.75.75 0 0 0-.75-.75H10ZM6 13.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V14a.75.75 0 0 0-.75-.75H6ZM8 13.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V14a.75.75 0 0 0-.75-.75H8ZM9.25 14a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 .75.75v.01a.75.75 0 0 1-.75.75H10a.75.75 0 0 1-.75-.75V14ZM12 11.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V12a.75.75 0 0 0-.75-.75H12ZM12 13.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V14a.75.75 0 0 0-.75-.75H12ZM13.25 12a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 .75.75v.01a.75.75 0 0 1-.75.75H14a.75.75 0 0 1-.75-.75V12ZM11.25 10.005c0-.417.338-.755.755-.755h2a.755.755 0 1 1 0 1.51h-2a.755.755 0 0 1-.755-.755ZM6.005 11.25a.755.755 0 1 0 0 1.51h4a.755.755 0 1 0 0-1.51h-4Z" />
            <path fill-rule="evenodd" d="M5.75 2a.75.75 0 0 1 .75.75V4h7V2.75a.75.75 0 0 1 1.5 0V4h.25A2.75 2.75 0 0 1 18 6.75v8.5A2.75 2.75 0 0 1 15.25 18H4.75A2.75 2.75 0 0 1 2 15.25v-8.5A2.75 2.75 0 0 1 4.75 4H5V2.75A.75.75 0 0 1 5.75 2Zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75Z" clip-rule="evenodd" />
          </svg>                           
          <p class="ms-1 text-sm">Abonnieren</p>
        </a>
      </div>
    </section>



    <script>
      if (
        localStorage.theme === 'dark' ||
        (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }

      function getNextSunday20(now) {
        // Sun is 0 in JavaScript Date
        const day = now.getDay();
        let daysUntil = (7 - day); // Days until next Sun
        if (day === 0 && now.getHours() < 20) {
          daysUntil = 0; // Now is Sun but before 20
        }
        if (day === 0 && now.getHours() >= 20) {
          daysUntil = 7; // After 20 on Sunday, next Sunday
        }
        const target = new Date(now);
        target.setDate(now.getDate() + daysUntil);
        target.setHours(20, 0, 0, 0); // Sun 20:00
        return target;
      }

      function updateCountdown() {
        const now = new Date();
        // Check if is Sunday after 20:00
        if (now.getDay() === 0 && now.getHours() >= 20) {
          // Remove countdown, show banner
          document.getElementById("countdown").style.display = "none";
          let banner = document.getElementById("blubbsonntag-banner");
          if (!banner) {
            banner = document.createElement("div");
            banner.id = "blubbsonntag-banner";
            banner.className = "p-5 text-center text-3xl font-bold text-white frosted rounded-xl shadow-lg";
            banner.innerHTML = "Jetzt ist Blubbsonntag ðŸŽ‰";
            document.getElementById("countdown-section").appendChild(banner);
          } else {
            banner.style.display = "";
          }
          return;
        }

        // Show countdown, remove banner
        document.getElementById("countdown-section").style.display = "";
        const banner = document.getElementById("blubbsonntag-banner");
        if (banner) banner.style.display = "none";

        // Target next Sun 20:00
        const target = getNextSunday20(now);
        let diff = (target - now) / 1000; // in seconds
        diff = Math.max(0, Math.floor(diff));

        const days = Math.floor(diff / (60 * 60 * 24));
        const hours = Math.floor((diff % (60 * 60 * 24)) / 3600);
        const minutes = Math.floor((diff % 3600) / 60);
        const seconds = diff % 60;

        document.getElementById("days").innerText = days;
        document.getElementById("hours").innerText = hours.toString().padStart(2, '0');
        document.getElementById("minutes").innerText = minutes.toString().padStart(2, '0');
        document.getElementById("seconds").innerText = seconds.toString().padStart(2, '0');
      }

      setInterval(updateCountdown, 1000);
      updateCountdown();

    </script>
      
  </body>
</html>